# 极客时间的课程和南大的计算机基础课差不多,都是搓cpu的课程

## cisc & risc

1.芯片是所有半导体元器件的统称,cpu也只是芯片的一种而已.

2.cpu的工作流程分为5个步骤:
取指令,指令译码,执行指令,访问读取数据,结果写回.

3.cisc:
复杂指令集体系结构

4.risc:
精简指令集计算机体系结构
分为基本指令集和可扩展指令集,按需组合自由扩展

5.Verilog 语言的 module 模块化
自顶向下的一个模块树

## 4.硬件语言基础

cpu上做逻辑控制,大概有两种
1.时序逻辑.
2.组合逻辑.

Iverilog 是一个对 Verilog 进行编译和仿真的工具，
而 GTKWave 是一个查看仿真数据波形的工具.
安装 Iverilog：sudo apt-get install iverilog
安装 GTKWave：sudo apt-get install gtkwave

# 6.迷你cpu架构设计和取指令实现

pre_if:模块分支预测或预读取模块,如果上一条指令是分支跳转,则产生跳转pc
后,并对下一条指令进行预读取.

if_id:取指到译码之间的模块,指令预读之后会先送入if_id模块,如果当前流水线
没有发出指令清楚,if_id模块就会吧指令送到译码模块.

id_ex:译码到执行之间的模块,用于完成指令译码之后的寄存器索引值,以及指令执行的功能信息,
根据流水线控模块的控制信号,选择性的发送给执行模块去执行.

ex_mem:将执行之后将数据写进存储器,或者从中读取数据.

mem_wb:把运算结果或从存储器读出的数据,写回到通用寄存器.

# 7.如何实现指令译码模块

在risc-v中无论何种类型的指令
0-6位都是opcode,译码过程中,通过opcode对应的标识,
产生各种译码后的控制指令.
译码可以得到两种指令信号.
1.译码后产生的指令执行控制信号.
2.指令源码中提取的数据信息,如立即数,寄存器索引,功能码等等

当指令发生冲突的时候就需要清楚流水线的中的指令(这里的冲突到底是什么样子的,
还不太理解).
s,j,b型指令的立即数设置为不连续,是为了让rs1,rs2,rd寄存器的位置保持固定,
从而提高流水线的效率.不连续的立即数,只要在译码的时候拼接就好了.

# 9.CPU流水线的访存阶段

数据冒险

# 10.cpu写回模块

控制冒险:下一步的行为,修要依赖上一条指令的执行结果.
分支预测:直接给出跳转后的地址,如果不跳转,到达访存阶段时flush清0并更新pc值即可

# 11.让cpu跑起来

cpu通过总线(bus)和其他设备交互,这是一个一对多(主从结构)
只读存储器 ROM
随机访问存储器 RAM
通用异步收发传输器 UART(是电子设备间进行异步通信的常用模块)

# 14.c语言的执行逻辑

声明+定义

# 15.c与汇编

# 16.算术指令(加减,比较)

加法指令分为两种
1.寄存器加法
2.立即数加法
减法指令可以用加法+(负数)来实现
比较指令
有无符号立即数比较:slti,sltiu
有无符号寄存器比较:slt,sltu

# 17.算术指令(逻辑,位移)

与加法指令一致分为立即数版本和寄存器版本

# 18.跳转指令(无条件跳转)

跳转的本质就是修改pc寄存器的值.

但 jal 指令与 jalr 指令跳转的地址大小范围有差别，这主要取决于它们地址数据的编码形式和计算方式。
jal 指令是用当前 pc 值加上 20 位立即数,
jalr 指令是通用寄存器加上 11 位立即数

# 19.跳转指令(有条件跳转)

比较数据是否相等：beq 和 bne 指令

# 20.原子指令

LR/SC 用来实现基本的cas功能
AMO 原子操作

## 21.加载指令

字节(有无符号,8bit),半字(有无符号,16bit),字(32bit)
从内存加载到寄存器

## 22.访存指令

字节(8bit),半字(16bit),字(32bit)
从寄存器存储到内存地址

## 23.内存地址空间:程序中地址的三种方式

汇编语言的标号就是一段内存地址的开始.
源寄存器和立即数组成的数据,就是内存地址.
一个地址能精确找到一个内存字节单元.

在一台现在物理计算机上,各种设备和内存都是统一编址的,所以不同的地址段能访问到不同的设备.
CPU 把一个整数数据当成地址，放在地址总线上，由地址译码器选择该地址正确索引的设备或者内存进行访问.
CPU 通过地址访问内存，地址的本质是整数数据，而整数数据的本质是电子信号的组合。

链接器
链接多个程序模块，并且分配程序在运行过程中的地址。

虚拟地址由CPU 中的一个设备 MMU（内存管理单元)转换成具体的物理地址.

内存地址有几种产生方式：
一种是链接器对程序重定位后执行地址绑定，这地址是静态的；
第二种是在代码中直接定义地址；
第三种是动态分配内存，返回内存空间的首地址

## 24.虚拟地址和物理地址
cpu->mmu->内存

## 25.堆栈
1.proc文件系统观察内存布局

## 26.延迟分配：提高内存利用率的三种机制